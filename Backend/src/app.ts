import bodyParser from "body-parser";
import cors from "cors";
import dotenv from "dotenv";
import express from "express";
import path from "path";
import http from "http";
import { PORT } from "./config/config";
import { connectMongoDB } from "./config/db";
import { GenerateSwapPSBTRoute } from "./routes";
import {
  initData,
  depositAsset,
  depositUtxoAsset,
  preDepositUtxoAsset,
} from "./controller/deposit.Controller";
import {
  addTickets,
  sendTickets,
  preAddTicketsPsbt,
  addTicketsPsbt,
  preSendTickets,
} from "./controller/ticket.controller";
import { swap, preSwap } from "./controller/swap.Controller";
import { getAccountData } from "./utils/utils.service";
import { fetchTxStatus } from "./utils/utxo.service";
import { convertHexTo64 } from "./utils/psbt.service";

// Load environment variables from .env file
dotenv.config();

// Connect to the MongoDB database
connectMongoDB();

// Create an instance of the Express application
const app = express();

// Set up Cross-Origin Resource Sharing (CORS) options
app.use(cors());

// Parse incoming JSON requests using body-parser
app.use(express.json({ limit: "50mb" }));
app.use(express.urlencoded({ limit: "50mb", extended: true }));
app.use(bodyParser.json({ limit: "50mb" }));
app.use(bodyParser.urlencoded({ limit: "50mb", extended: true }));

const server = http.createServer(app);

app.use("/api/swap", GenerateSwapPSBTRoute);

// initData();
// preDepositUtxoAsset(
//   0,
//   "39241:1",
//   200,
//   "",
//   0,
//   "tb1pgda5khhwqlc7jmdzn4plca3pa4m7jg38zcspj0mmuyk8hnj5pphskers72",
//   "026272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823"
// );
// preDepositUtxoAsset(
//   1,
//   "",
//   0,
//   "2cd07c0004b3a6230118228279672190b1e3efb7574816ce93e5f8173cd8bc3ai0",
//   0,
//   "tb1pgda5khhwqlc7jmdzn4plca3pa4m7jg38zcspj0mmuyk8hnj5pphskers72",
//   "026272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823"
// );
// preDepositUtxoAsset(
//   2,
//   "",
//   0,
//   "",
//   2000,
//   "tb1pgda5khhwqlc7jmdzn4plca3pa4m7jg38zcspj0mmuyk8hnj5pphskers72",
//   "026272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823"
// );
// depositUtxoAsset(
//   "70736274ff0100890200000001b8c5f85c9f4133e0061ee1b26f02479b10738eb5cdf8ca9ee9f2559bc2e972ea0400000000ffffffff02d0070000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e3c8d070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f000000000001012bf498070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f0117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823000000",
//   "70736274ff0100890200000001b8c5f85c9f4133e0061ee1b26f02479b10738eb5cdf8ca9ee9f2559bc2e972ea0400000000ffffffff02d0070000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e3c8d070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f000000000001012bf498070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f010842014018da97743320687906e2c10db908ac7df30ac46ec91cda899e774b38660eee7137125d1d1a7672825969bbc418900bef57eee71cbcd9d27cc273b0ca656a89a2000000",
//   0,
//   "",
//   0,
//   "",
//   2000
// );
// preAddTicketsPsbt(
//   [
//     "ad1a6ee697de1c3ada0fedf4125f1087c9e2367a3c24de96a9abece831e51fd9i0",
//     "eba2ddfe2cd16c3d19b4f25c90686653f2a6e69c9eae436f3b012be7180481dci0",
//   ],
//   "tb1pgda5khhwqlc7jmdzn4plca3pa4m7jg38zcspj0mmuyk8hnj5pphskers72",
//   "026272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823"
// );
// addTicketsPsbt(
//   "70736274ff0100fd060102000000037653aeba4904fb99a93e0a69b82b18c0dec13f4b3fb1ca9f334ab2518e711f6c0000000000ffffffff32dd104165b9e9f599231182a39b7104729b87a5479fdcf0e27267064fb915f70000000000ffffffff2390567e6e0d1394566a0b14ee2b2dd19758e69b9d145f75cd6378e595c1b16a0400000000ffffffff034a010000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e4a010000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e9c88070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f000000000001012b4a01000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f0117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f58230001012b4a01000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f0117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f58230001012bc890070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f0117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f582300000000",
//   "70736274ff0100fd060102000000037653aeba4904fb99a93e0a69b82b18c0dec13f4b3fb1ca9f334ab2518e711f6c0000000000ffffffff32dd104165b9e9f599231182a39b7104729b87a5479fdcf0e27267064fb915f70000000000ffffffff2390567e6e0d1394566a0b14ee2b2dd19758e69b9d145f75cd6378e595c1b16a0400000000ffffffff034a010000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e4a010000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e9c88070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f000000000001012b4a01000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f01084201409dcad542c264cbdd75b2c9c539ee61e26dd3ad0dd18c1b263f02a6aca252c079a13bb69c8f1d129417904635f2e7375485d1127bd5375de521bf0e8b82cf38660001012b4a01000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f01084201406de83c192e97ef96fd459a0aaae4d7027585471704d2830c0a00fcd2774bf027746c44573a7997db93bcec329b7cf855ee35f097f857e7164b18aadb5a9fb2280001012bc890070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f0108420140ae8809b20d09013c79b8d5ce2b11a751634b257c0dfcf4e8211f61c893c8c9da73573d81985b42cfc2b0ef74ec34f7a959ba2cdcf568f646b9067cc819ba9bd700000000",
//   [
//     "ad1a6ee697de1c3ada0fedf4125f1087c9e2367a3c24de96a9abece831e51fd9i0",
//     "eba2ddfe2cd16c3d19b4f25c90686653f2a6e69c9eae436f3b012be7180481dci0",
//   ],
//   [330, 330]
// );
// preSendTickets(
//   ["ad1a6ee697de1c3ada0fedf4125f1087c9e2367a3c24de96a9abece831e51fd9i0"],
//   ["tb1pgda5khhwqlc7jmdzn4plca3pa4m7jg38zcspj0mmuyk8hnj5pphskers72"],
//   "tb1pgda5khhwqlc7jmdzn4plca3pa4m7jg38zcspj0mmuyk8hnj5pphskers72",
//   "026272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823"
// );
// sendTickets(
//   ["ad1a6ee697de1c3ada0fedf4125f1087c9e2367a3c24de96a9abece831e51fd9i0"],
//   "70736274ff0100890200000001c7b201836c9cc19839ce3979dc99268cbd40acd85908af8ad9176baabee4cede0300000000ffffffff024a01000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086fbe8a070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f000000000001012bc890070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f01030481000000011341fe44abf864a24cef42d1f49d5256508d876006b1891227745243074c1ebf63b195800f954b6f14dc82abc8f17ef945ca51d4829638fb1c6c8d914395a1327f0c810117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823000000"
// );
// preSwap(
//   "eba2ddfe2cd16c3d19b4f25c90686653f2a6e69c9eae436f3b012be7180481dci0",
//   "tb1pgda5khhwqlc7jmdzn4plca3pa4m7jg38zcspj0mmuyk8hnj5pphskers72",
//   "026272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f5823"
// );
// swap(
//   "70736274ff0100dd020000000222c72d80c4c5fcf4501a64a1b1c734eaaa699eb4dd7673a6132afe054ce5945a0000000000ffffffffd7c0b38fbbea8c9a2273931d654e79acfd4df44f39a363192dcd63b57b1128040100000000ffffffff034a0100000000000022512016280afbc5cacbb3a960939fab372e7e6969f9f42a521f1a62012645811c4ed9d007000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f3287070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f000000000001012b4a01000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f010304810000000117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f58230001012b3c8d070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f010304810000000117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f582300000000",
//   "70736274ff0100dd020000000222c72d80c4c5fcf4501a64a1b1c734eaaa699eb4dd7673a6132afe054ce5945a0000000000ffffffffd7c0b38fbbea8c9a2273931d654e79acfd4df44f39a363192dcd63b57b1128040100000000ffffffff034a0100000000000022512016280afbc5cacbb3a960939fab372e7e6969f9f42a521f1a62012645811c4ed9d007000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f3287070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f000000000001012b4a01000000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f01030481000000011341e8af4ed0617289d3109279007d2c3a028e5c684c5a91b934009cb4d6ebf72a4bc98bc4cceb1d59b2a04170cc3065ba242a9015e5efb41e125814dffc0b95b7bb810117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f58230001012b3c8d070000000000225120437b4b5eee07f1e96da29d43fc7621ed77e922271620193f7be12c7bce54086f01030481000000011341bed842f22c80cece65f5d71b3b8af6dd00b152ae532c932da8aba9bc28077d4ae041e88d2fb8779f0c3e062ac7b79f2b92cd2ae3a2a348d67d823005cae7eb97810117206272fe4cf7746c9c3de3d48afc5f27fe4ba052fc8f72913a6020fa970f7f582300000000",
//   2
// );
// getAccountData();
// preDepositUtxoAsset(
//   2,
//   "",
//   0,
//   "",
//   2000,
//   "tb1pze0vjgs5yxf04qn5u4yye0kvr883wfl66gmctvzkhrycx6qst8ms8h2ndy",
//   "02942d611c2f51bc136699963547f1c49be23c060c99950d4928963f8c2f6699b7"
// );
// console.log(
//   convertHexTo64(
//     "70736274ff01008902000000013293fb0c8ee28fc617d9f2e8e29db5119e4d3af8941c18b8fc8941a5a00de1600100000000ffffffff0222020000000000002251205103eb0040b0ef6bdef97c99ea2c721412e55aabec235f07dc32926e4590af5dc6e70100000000002251205103eb0040b0ef6bdef97c99ea2c721412e55aabec235f07dc32926e4590af5d000000000001012bd0ed0100000000002251205103eb0040b0ef6bdef97c99ea2c721412e55aabec235f07dc32926e4590af5d01084301411559787d2b7e4a0e52e39c52591282f16e996e405b6c8de72277e3ea5a3dd07fa9138aa753a0a7db87fc92f16b5f30b64e0aca5a43685d25b4bec61baddc9e3381000000"
//   )
// );
// depositUtxoAsset(
//   "70736274ff0100890200000001585ba612b9b19c9e9a53594caaa79dc5c903e8e6a049ed763f1c610d461613e60000000000ffffffff02d0070000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e581b0000000000002251205103eb0040b0ef6bdef97c99ea2c721412e55aabec235f07dc32926e4590af5d000000000001012b10270000000000002251205103eb0040b0ef6bdef97c99ea2c721412e55aabec235f07dc32926e4590af5d011720942d611c2f51bc136699963547f1c49be23c060c99950d4928963f8c2f6699b7000000",
//   "70736274ff0100890200000001585ba612b9b19c9e9a53594caaa79dc5c903e8e6a049ed763f1c610d461613e60000000000ffffffff02d0070000000000002251204da0ef6897b49b77d74f4abf9438e8f673ce00df5ec1c06c640c76de6519692e581b0000000000002251205103eb0040b0ef6bdef97c99ea2c721412e55aabec235f07dc32926e4590af5d000000000001012b10270000000000002251205103eb0040b0ef6bdef97c99ea2c721412e55aabec235f07dc32926e4590af5d010842014086bc36eba0c8cd85e21a618be6965c9befb0663d3aa23d2c37a87d1b104e4549de0dd66fd7a262b1e74d125a2874991a8d45ad85b88f8d7f90c5ff88d7058f0e000000",
//   0,
//   "",
//   0,
//   "",
//   2000
// );

app.get("/", async (req: any, res: any) => {
  res.send("Working Version Backend Server is Running now!");
});

server.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
});
